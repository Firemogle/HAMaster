- id: emi_fan_speed
  alias: emi_fan_speed
  initial_state: 'off'
  trigger:
  - entity_id: sensor.emi_temp
    platform: state
  condition:
    - condition: state
      entity_id: 'fan.emi_fan'
      state: 'on'
  action:
  - service: fan.set_speed
    data_template:
      entity_id: fan.emi_fan
      speed: >
        {% if (states.sensor.emi_temp.state|float > 80 ) %}
          on
        {% elif (states.sensor.emi_temp.state|float <= 80 ) and (states.sensor.emi_temp.state|float > 76 ) %} 
          high
        {% elif (states.sensor.emi_temp.state|float <= 76 ) and (states.sensor.emi_temp.state|float > 74 ) %} 
          medium
        {% elif (states.sensor.emi_temp.state|float <= 74 ) %} 
          low
        {% endif %}


